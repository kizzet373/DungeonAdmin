<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <title>Class Details</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="content-type" content="text/html;charset=UTF-8">
    <meta http-equiv="content-language" content="en">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.13.7/cdn.min.js" defer></script>

    <script src="/scripts/google-auth.js"></script>
    <script src="/scripts/entity-loader.js"></script>
    <script src="/scripts/global-utilities.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/theme_standard-blue.css">
</head>

<body id="html-body" x-data="classData()">
    <div class="container-wrap">

        <div id="header-placeholder"></div>
        <script>fetch('/header.html').then(r => r.text()).then(h => { document.getElementById('header-placeholder').outerHTML = h; }).catch(error => console.error('Error loading header:', error));</script>

        <main class="content-wrap" role="main">
            <div class="container content">
                <div class="row">
                    <div class="main-content-wrap col-md-12">
                        <div class="main-content">
                            <template x-if="!cls && isReady">
                                <div class="not-found p-3">
                                    <h3>Class Not Found</h3>
                                    <p>Sorry, the class you're looking for couldn't be found.</p>
                                    <p>You can <a href="/content/all-classes">view all classes here</a>.</p>
                                </div>
                            </template>

                            <div x-show="!isReady" class="loading-spinner"></div>

                            <template x-if="cls && isReady">
                                <div>
                                    <div class="page-title page-header"><span x-text="cls.name"></span></div>
                                    <div class="breadcrumbs">
                                        <a href="/index">Home</a> &raquo;
                                        <a href="/content/all-classes">All Classes</a> &raquo;
                                        <span x-text="cls.name"></span>
                                    </div>

                                    <div>
                                        <p><i><b>Source:</b> <span x-text="cls.source || 'Core Rulebook'"></span></i></p>
                                    </div>

                                    <div x-show="cls['class description']" x-html="cls['class description']"></div>

                                    <div x-show="cls['subclasses']?.length">
                                        <h3>Subclasses</h3>
                                        <ul>
                                            <template x-for="sub in cls['subclasses']" :key="sub.url || sub.name">
                                                <li>
                                                    <a :href="sub.url" x-text="sub.name"></a>
                                                </li>
                                            </template>
                                        </ul>
                                    </div>

                                    <div class="wiki-content-table-container">
                                        <table class="wiki-content-table">
                                            <tbody>
                                                <tr>
                                                    <th x-text="`Core ${cls.name} Traits`" colspan="2"></th>
                                                </tr>

                                                <template x-if="cls['core traits']?.length">
                                                    <template x-for="trait in cls['core traits']" :key="trait.name">
                                                        <tr>
                                                            <td><strong x-text="trait.name"></strong></td>
                                                            <td x-html="trait['html description']"></td>
                                                        </tr>
                                                    </template>
                                                </template>
                                            </tbody>
                                        </table>
                                    </div>

                                    <div x-show="cls['multiclass requirements']?.length || cls['multiclass characteristics']?.length">
                                        <h1>Multiclassing</h1>

                                        <div x-show="cls['multiclass requirements']?.length">
                                            <h2>Multiclass Requirements</h2>
                                            <ul>
                                                <template x-for="req in cls['multiclass requirements']" :key="req">
                                                    <li x-text="req"></li>
                                                </template>
                                            </ul>
                                        </div>

                                        <div x-show="cls['multiclass characteristics']?.length">
                                            <h2>Multiclass Characteristics</h2>
                                            <template x-for="mc in cls['multiclass characteristics']" :key="mc.name">
                                                <div class="mb-3">
                                                    <h5 x-text="mc.name"></h5>
                                                    <div x-html="mc.html_content"></div>
                                                </div>
                                            </template>
                                        </div>
                                    </div>

                                    <div x-show="cls['class feature table']?.length">
                                        <h1>Class Feature Table</h1>

                                        <template x-for="tbl in cls['class feature table']" :key="tbl.name">
                                            <div class="mb-4">
                                                <h4 x-text="tbl.name"></h4>

                                                <div class="wiki-content-table-container">
                                                    <table class="wiki-content-table">
                                                        <thead>
                                                            <tr>
                                                                <template x-for="col in tbl.columns" :key="col">
                                                                    <th x-text="col"></th>
                                                                </template>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <template x-for="(row, rIdx) in tbl.rows" :key="rIdx">
                                                                <tr>
                                                                    <template x-for="(cell, cIdx) in row" :key="cIdx">
                                                                        <td x-html="cell"></td>
                                                                    </template>
                                                                </tr>
                                                            </template>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </template>
                                    </div>

                                    <div x-show="cls['features']?.length">
                                        <h1>Class Features</h1>

                                        <template x-for="feat in cls['features']" :key="`${feat.level}-${feat.name}`">
                                            <div class="mb-4">
                                                <h2>
                                                    <span x-text="`Level ${feat.level}: ${feat.name}`"></span>
                                                </h2>
                                                <div x-html="feat.html_content"></div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <div id="footer-placeholder"></div>
        <script>fetch('/footer.html').then(r => r.text()).then(h => { document.getElementById('footer-placeholder').outerHTML = h; }).catch(error => console.error('Error loading header:', error));</script>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            document.addEventListener('globalEditionHandled', async (event) => {
                await loadEntity(window.currentGlobalEdition, `${window.location.hash.substring(1)}`, "/class/");
            });
        });

        document.addEventListener('alpine:init', () => {
            Alpine.data('classData', function () {
                return {
                    className: null,
                    cls: null,
                    isReady: false,

                    init() {
                        this.className = window.location.hash.substring(1);
                        
                        window.addEventListener('hashchange', () => {
                            window.location.reload();
                        });

                        document.addEventListener(`${this.className}Loaded`, (e) => { 
                            this.cls = window.entities?.[this.className];
                            document.title = this.cls.name;
                            this.isReady = true;
                        });

                        document.addEventListener(`${this.className}Failed`, (e) => { 
                            this.isReady = true;
                        });
                    }
                };
            });
        });
    </script>
</body>

</html>