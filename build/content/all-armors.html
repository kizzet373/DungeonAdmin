<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title x-text="pageTitle">Entity</title>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Optional: filters/tabs/hash manager like all-spells -->
  <script src="/scripts/all-entity-page-manager.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.13.7/cdn.min.js" defer></script>

  <!-- Auth + edition + loader -->
  <script src="/scripts/google-auth.js"></script>
  <script src="/scripts/global-utilities.js"></script>
  <script src="/scripts/entity-loader.js"></script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/theme_standard-blue.css">
</head>

<body>
  <div id="header-placeholder"></div>
  <script>
    fetch('/header.html')
      .then(r => r.text())
      .then(html => document.getElementById('header-placeholder').outerHTML = html);
  </script>

  <main class="container content" x-data="entityPage()" x-cloak>
    <div x-show="!isReady" class="loading-spinner"></div>

    <template x-if="isReady">
      <div>
        <h1 class="page-title page-header">
          <span x-text="pageTitle"></span>
        </h1>

        <!-- Your templates go here -->
        <div id="page-content">
          <template x-for="row in rows" :key="row.id || row.name">
            <div class="mb-2">
              <div class="fw-bold" x-text="row.name"></div>
              <div x-text="row.summary || ''"></div>
            </div>
          </template>
        </div>
      </div>
    </template>
  </main>

  <script>
    const ENTITY_NAME = 'spells'; // change per page

    document.addEventListener('DOMContentLoaded', () => {
      document.addEventListener('globalEditionHandled', async () => {
        await loadEntity(window.currentGlobalEdition, ENTITY_NAME);
      });
    });

    document.addEventListener('alpine:init', () => {
      Alpine.data('entityPage', () => ({
        pageTitle: 'Entities',
        isReady: false,

        // data
        all: [],
        rows: [],

        // optional manager (filters/tabs/hash)
        EPManager: null,
        activeFilter: {},
        activeTab: 0,

        init() {
          // OPTIONAL: enable hash filters/tabs like all-spells
          // this.EPManager = window.createEntityPageManager(
          //   this,
          //   (newActiveFilter, filtered, newActiveTab, availableTabs) => {
          //     this.activeFilter = { ...newActiveFilter };
          //     this.activeTab = newActiveTab;
          //     this.rows = filtered;
          //   },
          //   { tabProperty: 'level', tabValues: [0,1,2,3,4,5,6,7,8,9] }
          // );
          // this.EPManager.initialize();

          document.addEventListener(`${ENTITY_NAME}Loaded`, () => {
            this.all = window.entities?.[ENTITY_NAME] || [];

            // If using EPManager:
            // this.EPManager.setEntityData(this.all);
            // this.rows = this.EPManager.getFilteredData();

            // If NOT using EPManager:
            this.rows = this.all;

            queueMicrotask(() => { this.isReady = true; });
          });
        }
      }));
    });
  </script>
</body>
</html>
